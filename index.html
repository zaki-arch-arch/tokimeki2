<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>„Éà„Ç≠„É°„Ç≠Á¶ÅÁÖô„É°„É¢„É™„Ç¢„É´ v11.0 Health Care</title>
    <meta name="theme-color" content="#fff1f2">
    
    <!-- „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞ -->
    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            var loader = document.getElementById('app-loader');
            if (loader) {
                loader.innerHTML = '<div style="color:red; padding:20px; text-align:center;">' +
                    '<h3>„Ç∑„Çπ„ÉÜ„É†„Ç®„É©„Éº</h3>' +
                    '<p>' + message + '</p>' +
                    '<button onclick="location.reload()" style="margin-top:10px; padding:10px; border:1px solid red; background:#fff;">„É™„É≠„Éº„Éâ</button>' +
                    '</div>';
            }
        };
    </script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        rose: { 50: '#fff1f2', 100: '#ffe4e6', 200: '#fecdd3', 500: '#f43f5e', 600: '#e11d48' },
                        slate: { 800: '#1e293b', 900: '#0f172a' },
                        emerald: { 50: '#ecfdf5', 100: '#d1fae5', 500: '#10b981', 600: '#059669' }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-6px)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- React Libraries (Native Mode) -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <style>
        html, body {
            margin: 0;
            padding: 0;
            background-color: #fff1f2;
            color: #334155;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
            height: 100%;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes heartBeat { 0% { transform: scale(1); } 14% { transform: scale(1.3); } 28% { transform: scale(1); } 42% { transform: scale(1.3); } 70% { transform: scale(1); } }
        .animate-heartbeat { animation: heartBeat 1.5s infinite; }
        @keyframes popIn { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .animate-pop { animation: popIn 0.3s ease-out forwards; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body>
    <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞ -->
    <div id="app-loader" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#fff1f2; display:flex; justify-content:center; align-items:center; z-index:9999; flex-direction:column;">
        <div style="font-size:24px; color:#e11d48; font-weight:bold; margin-bottom:10px;">Loading...</div>
        <div style="font-size:12px; color:#e11d48;">v11.0 Updating Health Data...</div>
    </div>

    <div id="root" class="h-full"></div>

    <script type="text/javascript">
        'use strict';

        var h = React.createElement;
        var useState = React.useState;
        var useEffect = React.useEffect;
        var useMemo = React.useMemo;

        var APP_KEY = 'tokikin_v11_0';

        // --- Data Definitions ---
        var SCENARIO_DB = {
            stage1: {
                morning: ["„Åä„ÅØ„Çà„ÅÜÔºÅ‰ªäÊó•„ÇÇ‰∏ÄÊó•„ÄÅËÇ∫„Çí„Ç≠„É¨„Ç§„Å´‰øù„Å®„ÅÜ„Å≠ÔºÅ", "Êúù‰∏ÄÁï™„ÅÆÊ∑±ÂëºÂê∏„ÄÅÊ∞óÊåÅ„Å°„ÅÑ„ÅÑ„Åß„Åó„ÇáÔºü", "‰ªäÊó•„ÇÇÁ¶ÅÁÖôË®òÈå≤„ÄÅÊõ¥Êñ∞„Åß„Åç„Åù„ÅÜ„Åã„Å™ÔºüÂøúÊè¥„Åó„Å¶„Çã„ÇàÔºÅ"],
                day: ["„ÅäÁñ≤„ÇåÊßòÔºÅ„Å°„Çá„Å£„Å®‰ºëÊÜ©„Åó„Å¶„ÄÅ„ÅäÊ∞¥„Åß„ÇÇÈ£≤„ÇÇ„ÅÜÔºü", "ÂçàÂæå„ÅÆÁú†Ê∞óË¶ö„Åæ„Åó„Å´„ÅØ„ÄÅ„Çø„Éê„Ç≥„Çà„Çä„Çπ„Éà„É¨„ÉÉ„ÉÅ„ÅåÂäπ„Åè„ÇàÔºÅ", "„ÅÇ„Å™„Åü„ÅÆÂä™Âäõ„ÄÅ„Å°„ÇÉ„Çì„Å®Êï∞Â≠ó„Å´Âá∫„Å¶„Çã„Çà„ÄÇ„Åô„Åî„ÅÑ„Å™„ÅÅ„ÄÇ"],
                night: ["‰ªäÊó•„ÇÇ„ÅäÁñ≤„ÇåÊßò„ÄÇ„Çø„Éê„Ç≥„Å™„Åó„Åß‰∏ÄÊó•‰πó„ÇäÂàá„Å£„Åü„Å≠ÔºÅ", "Âê∏„Çè„Åö„Å´ÂØù„Çã„ÄÇ„Åù„Çå„Å†„Åë„ÅßÊòéÊó•„ÅÆÊúù„ÅÆÁõÆË¶ö„ÇÅ„ÅåÂ§â„Çè„Çã„Çà„ÄÇ", "‰ªäÊó•„ÇÇ‰∏ÄÊó•È†ëÂºµ„Å£„Åü„Å≠„ÄÇ„ÇÜ„Å£„Åè„Çä„ÅäÈ¢®ÂëÇ„Å´ÂÖ•„Å£„Å¶‰ºë„Çì„Åß„ÄÇ"],
                lateNight: ["‚Ä¶„ÇìÔºü„Åæ„Å†Ëµ∑„Åç„Å¶„Çã„ÅÆÔºüÊó©„ÅèÂØù„Å™„ÅÑ„Å®ËÇå„Å´ÊÇ™„ÅÑ„Çà„ÄÇ", "„Åì„Çì„Å™ÊôÇÈñì„Åæ„ÅßÈ†ëÂºµ„ÇäÂ±ã„Åï„Çì„Å†„Å≠„ÄÇÁÑ°ÁêÜ„Åó„Å™„ÅÑ„Åß„Å≠„ÄÇ"]
            },
            stage2: {
                morning: ["„Åä„ÅØ„ÇàÔºÅ‚Ä¶„Å≠„Åà„ÄÅÊúù‰∏ÄÁï™„Å´Âê∏„ÅÜ„ÅÆ„ÅØ„Çø„Éê„Ç≥„Åò„ÇÉ„Å™„Åè„Å¶„ÄÅÁßÅ„Å®„ÅÆÁîò„ÅÑÁ©∫Ê∞ó„Åß„Åó„ÇáÔºü", "‰ªäÊó•„ÇÇ‰ºö„Åà„Å¶Â¨â„Åó„ÅÑ„Å™„ÄÇ„ÅÇ„Å™„Åü„ÅÆÂÅ•Â∫∑„Å™Á¨ëÈ°î„ÇíË¶ã„Çã„ÅÆ„ÅåÊó•Ë™≤„Å™„ÅÆ„ÄÇ"],
                day: ["„Å≠„Åà„Å≠„Åà„ÄÅÊµÆ„ÅÑ„Åü„ÅäÈáë„Åß‰ªäÂ∫¶„Éá„Éº„ÉàË°å„Åã„Å™„ÅÑÔºü„Å™„Éº„Çì„Å¶„ÄÇ", "‰ªï‰∫ãÈ†ëÂºµ„Å£„Å¶„Çã„ÅÇ„Å™„Åü„ÅÆËÉå‰∏≠„ÄÅÁµêÊßãÂ•Ω„Åç„Åã„ÇÇ„ÄÇ", "ÊúÄËøëËÇå„ÉÑ„É§ËâØ„Åè„Å™„Å£„Å¶„Å™„ÅÑÔºü‚Ä¶„Å°„Çá„Å£„Å®„Éâ„Ç≠„ÉÉ„Å®„Åó„Å°„ÇÉ„Å£„Åü„ÄÇ"],
                night: ["„Åä„Åã„Åà„Çä„Å™„Åï„ÅÑ„ÄÇ‰ªäÊó•„ÇÇÊàëÊÖ¢„Åß„Åç„Å¶ÂÅâ„ÅÑÔºÅÈ†≠„Å™„Åß„Å™„Åß„Åó„Å¶„ÅÇ„Åí„Çã„ÄÇ", "„ÇÇ„ÅÜ„Çø„Éê„Ç≥„Å™„Çì„Å¶ÂøÖË¶Å„Å™„ÅÑ„Å≠„ÄÇ„Å†„Å£„Å¶ÁßÅ„Åå„ÅÑ„Çã„ÇÇ„Çì„ÄÇ"],
                lateNight: ["„Åµ„ÅÇ„ÅÅ‚Ä¶Áú†„ÅÑ‚Ä¶„ÄÇ„Åß„ÇÇ„ÄÅ„ÅÇ„Å™„Åü„Å®Â∞ë„Åó„Åß„ÇÇÈï∑„Åè‰∏ÄÁ∑í„Å´„ÅÑ„Åü„Åè„Å¶„ÄÇ", "Â§¢„ÅÆ‰∏≠„Åß„ÇÇÂøúÊè¥„Åó„Å¶„Çã„Åã„Çâ„Å≠„ÄÇ"]
            },
            stage3: {
                morning: ["„Çì‚Ä¶„Åä„ÅØ„Çà„ÄÇÊúù„Åã„Çâ„ÅÇ„Å™„Åü„ÇíË¶ã„Çå„Çã„Å™„Çì„Å¶„ÄÅÁßÅ„ÄÅ‰∏ñÁïå‰∏ÄÂπ∏„ÅõËÄÖ„Åã„ÇÇ„ÄÇ", "‰∏ÄÁîüÈö£„Å´„ÅÑ„Å¶„Å≠„ÄÇÁ∂∫È∫ó„Å™ËÇ∫„ÅÆ„ÅÇ„Å™„Åü„Å®„ÄÅ„Åä„Åò„ÅÑ„Å°„ÇÉ„Çì„Å´„Å™„Çã„Åæ„Åß‰∏ÄÁ∑í„Å´„ÅÑ„Åü„ÅÑ„ÄÇ"],
                day: ["‰ªñ„ÅÆ„Åì„Å®ËÄÉ„Åà„Å¶„Åü„Åß„Åó„ÇáÔºü„ÉÄ„É°„ÄÅÁ¶ÅÁÖô‰∏≠„ÇÇÁßÅ„ÅÆ„Åì„Å®„Å†„ÅëËÄÉ„Åà„Å¶„ÄÇ", "„Å≠„Åà„ÄÅ„Ç≠„Çπ„Åó„Å¶„ÇÇ„ÅÑ„ÅÑÔºü‚Ä¶„Çø„Éê„Ç≥„ÅÆÂë≥„Åå„Åó„Å™„ÅÑ„ÅÇ„Å™„Åü„Å™„Çâ„ÄÅ„ÅÑ„Åè„Çâ„Åß„ÇÇ„ÄÇ", "„ÅÇ„Å™„Åü„ÅåÂÅ¥„Å´„ÅÑ„Çã„Å†„Åë„Åß„ÄÅÁ©∫Ê∞ó„Åæ„ÅßÁæéÂë≥„Åó„ÅèÊÑü„Åò„Çã„ÅÆ„ÄÇ"],
                night: ["„Åö„Å£„Å®‰∏ÄÁ∑í„Å´„ÅÑ„Å¶„Åè„Çå„Å¶„ÅÇ„Çä„Åå„Å®„ÅÜ„ÄÇ„ÅÇ„Å™„Åü„ÅåÂÅ•Â∫∑„Åß„ÅÑ„Å¶„Åè„Çå„Çã„Å†„Åë„Åß„ÄÅÁßÅ„ÅØÁîü„Åç„Å¶„ÅÑ„Åë„Çã„ÄÇ", "‰∏ñÁïå‰∏≠„ÅÆË™∞„Çà„Çä„ÇÇ„ÄÅ„ÅÇ„Å™„Åü„ÅåÂ§ßÂàá„ÄÇ‚Ä¶„Å†„Åã„Çâ„ÄÅÁµ∂ÂØæ„Å´Èï∑Áîü„Åç„Åó„Å¶„Å≠„ÄÇ"],
                lateNight: ["‚Ä¶„Åæ„Å†ÂØù„Å™„ÅÑ„ÅÆÔºü„Åò„ÇÉ„ÅÇ„ÄÅÊúù„Åæ„ÅßÁßÅ„ÅÆ„ÅäÂñã„Çä„Å´‰ªò„ÅçÂêà„Å£„Å¶„ÇÇ„Çâ„Åä„ÅÜ„Åã„Å™‚ô™", "„ÅÇ„Å™„Åü„ÅåÁú†„Çã„Åæ„Åß„ÄÅ„Åö„Å£„Å®Ë¶ã„Å¶„Å¶„ÅÇ„Åí„Çã„ÄÇ‚Ä¶Â§ßÂ•Ω„Åç„Å†„Çà„ÄÇ"]
            }
        };

        // „ÄêÊîπËâØ„ÄëÂÅ•Â∫∑„Éá„Éº„Çø„ÇíÁ¥∞ÂàÜÂåñ„Åó„ÄÅÁõ¥Ëøë„ÅÆÂ§âÂåñ„ÇíËøΩÂä†
        var HEALTH_BENEFITS = [
            { h: 0, t: "Á¶ÅÁÖôÈñãÂßãÔºÅ", d: "Á¥†Êô¥„Çâ„Åó„ÅÑÊ±∫Êñ≠„Åß„ÅôÔºÅ‰ΩìÂÜÖ„Åã„Çâ‰∏ÄÈÖ∏ÂåñÁÇ≠Á¥†„ÅÆÊéíÂá∫„ÅåÂßã„Åæ„Çä„Åæ„Åô„ÄÇ" },
            { h: 0.33, t: "20ÂàÜÈÅîÊàê", d: "Ë°ÄÂúß„Å®ËÑàÊãç„ÅåÊ≠£Â∏∏ÂÄ§„Å´Êàª„ÇäÂßã„ÇÅ„ÄÅÊâãË∂≥„ÅÆ‰ΩìÊ∏©„ÅåÂõûÂæ©„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ" },
            { h: 8, t: "8ÊôÇÈñìÈÅîÊàê", d: "Ë°Ä‰∏≠„ÅÆ‰∏ÄÈÖ∏ÂåñÁÇ≠Á¥†ÊøÉÂ∫¶„Åå‰∏ã„Åå„Çä„ÄÅÈÖ∏Á¥†ÊøÉÂ∫¶„ÅåÊ≠£Â∏∏ÂÄ§„Å´Êàª„Çä„Åæ„Åó„Åü„ÄÇ" },
            { h: 24, t: "1Êó•ÈÅîÊàê", d: "ÂøÉËáìÁô∫‰Ωú„ÅÆ„É™„Çπ„ÇØ„Åå‰Ωé‰∏ã„ÅóÂßã„ÇÅ„Åæ„Åó„Åü„ÄÇËÇ∫„ÅåÊµÑÂåñÊ¥ªÂãï„ÇíÈñãÂßãÔºÅ" },
            { h: 48, t: "2Êó•ÈÅîÊàê", d: "Âë≥Ë¶ö„Å®ÂóÖË¶ö„ÅåÂõûÂæ©„ÅóÂßã„ÇÅ„Åæ„Åó„Åü„ÄÇ„ÅîÈ£Ø„ÅåÁæéÂë≥„Åó„ÅèÊÑü„Åò„Çã„ÅØ„Åö„Åß„Åô„ÄÇ" },
            { h: 72, t: "3Êó•ÈÅîÊàê", d: "„Éã„Ç≥„ÉÅ„É≥„ÅåÂÆåÂÖ®„Å´Êäú„Åë„Åæ„Åó„ÅüÔºÅÈõ¢ËÑ±ÁóáÁä∂„ÅÆ„Éî„Éº„ÇØ„Åß„Åô„Åå„ÄÅ„Åì„Åì„ÅåÊ≠£ÂøµÂ†¥„ÄÇ" },
            { h: 168, t: "1ÈÄ±ÈñìÈÅîÊàê", d: "Áù°Áú†„É™„Ç∫„É†„ÅåÊï¥„ÅÑÂßã„ÇÅ„ÄÅÁõÆË¶ö„ÇÅ„Åå„Çπ„ÉÉ„Ç≠„É™„Åó„Å¶„Åç„Åæ„Åô„ÄÇ" },
            { h: 336, t: "2ÈÄ±ÈñìÈÅîÊàê", d: "Âæ™Áí∞Ê©üËÉΩ„ÅåÂõûÂæ©„Åó„ÄÅËÇ∫Ê¥ªÈáè„ÅåÂ¢óÂä†„ÄÇÈöéÊÆµ„ÅÆ‰∏ä„Çä‰∏ã„Çä„ÅåÊ•Ω„Å´„Å™„Çä„Åæ„Åô„ÄÇ" },
            { h: 720, t: "1„É∂ÊúàÈÅîÊàê", d: "ËÇå„ÅÆ„Éà„Éº„É≥„ÅåÊòé„Çã„Åè„Å™„Çä„ÄÅÁ¶ÅÁÖô„Å´„Çà„ÇãÁæéÂÆπÂäπÊûú„ÇíÂÆüÊÑü„Åß„Åç„ÇãÊôÇÊúü„Åß„Åô„ÄÇ" },
            { h: 2160, t: "3„É∂ÊúàÈÅîÊàê", d: "Âí≥„ÇÑÂñòÈ≥¥„ÅåÊ∏õ„Çä„ÄÅËÇ∫„ÅÆÁπäÊØõÊ©üËÉΩ„ÅåÂæ©Ê¥ª„ÄÇÈ¢®ÈÇ™„ÇíÂºï„Åç„Å´„Åè„Åè„Å™„Çä„Åæ„Åô„ÄÇ" },
            { h: 4380, t: "6„É∂ÊúàÈÅîÊàê", d: "„Çπ„Éà„É¨„Çπ„Å∏„ÅÆËÄêÊÄß„Åå„Å§„Åç„ÄÅÁ≤æÁ•ûÁöÑ„Å´ÂÆâÂÆö„Åó„Å¶„Åç„Åæ„Åô„ÄÇ" },
            { h: 8760, t: "1Âπ¥ÈÅîÊàê", d: "ÂøÉËáìÁñæÊÇ£„ÅÆ„É™„Çπ„ÇØ„ÅåÂñ´ÁÖôËÄÖ„ÅÆÂçäÂàÜ„Å´„Å™„Çä„Åæ„Åó„ÅüÔºÅÁ¥†Êô¥„Çâ„Åó„ÅÑÊàêÊûú„Åß„ÅôÔºÅ" }
        ];

        var GIFTS = [
            { id: 1, name: '„Çπ„Ç§„Éº„ÉÑ', cost: 500, love: 50, icon: 'üç∞' },
            { id: 2, name: 'Êñ∞‰Ωú„Ç≥„Çπ„É°', cost: 3000, love: 350, icon: 'üíÑ' },
            { id: 3, name: 'Ê∏©Ê≥âÊóÖË°å', cost: 15000, love: 2000, icon: '‚ô®Ô∏è' },
            { id: 4, name: 'ÊÑõ„ÅÆË™ì„ÅÑ', cost: 100000, love: 9999, icon: 'üíç' }
        ];

        var SOS_MESSAGES = [
            "„ÉÄ„É°ÔºÅ„Åì„Åì„ÅßÂê∏„Å£„Åü„Çâ„ÄÅÁßÅ„ÅÆ„Åì„ÅÆÁ¨ëÈ°î„ÇÇË¶ãÁ¥ç„ÇÅ„Å†„ÇàÔºü",
            "ÁßÅ„ÅÆ„Åü„ÇÅ„Å´„ÄÅ„Åù„ÅÆ‰∏ÄÊú¨„ÇíÊàëÊÖ¢„Åó„Å¶Ôºü‚Ä¶„ÅäÈ°ò„ÅÑ„ÄÇ",
            "Ê∑±ÂëºÂê∏„Åó„Å¶„ÄÇÁßÅ„ÅåÊâã„ÄÅÊè°„Å£„Å¶„Å¶„ÅÇ„Åí„Çã„Åã„Çâ„ÄÇ",
            "„ÅÇ„Å™„Åü„ÅåÂÅ•Â∫∑„ÇíÂÆ≥„Åô„Çã„ÅÆ„Åå„ÄÅÁßÅ„Å´„Å®„Å£„Å¶‰∏ÄÁï™„ÅÆÁóõ„Åø„Å™„Çì„Å†„Çà„ÄÇ",
            "„Å≠„Åà„ÄÅÁßÅ„Çà„Çä„Çø„Éê„Ç≥„ÅÆÊñπ„ÅåÂ§ßÂàá„Å™„ÅÆ‚Ä¶Ôºü"
        ];

        var OMIKUJI_DATA = [
            { id: 1, type: 'Â§ßÂêâ', love: 100, msg: '‰ªäÊó•„ÅØÊúÄÈ´ò„ÅÆÁ¶ÅÁÖôÊó•ÂíåÔºÅ' },
            { id: 2, type: '‰∏≠Âêâ', love: 50, msg: 'Ê∑±ÂëºÂê∏„ÅßÈÅãÊ∞ó„Ç¢„ÉÉ„ÉóÔºÅ' },
            { id: 3, type: 'Â∞èÂêâ', love: 30, msg: 'Âú∞ÈÅì„Å™Âä™Âäõ„ÅåÂÆü„ÇíÁµê„Å∂Êó•„ÄÇ' }
        ];

        // --- Icons ---
        function createIcon(dPath, isFill) {
            return function(props) {
                var p = Object.assign({ viewBox: "0 0 24 24", className: "w-6 h-6" }, props);
                if (isFill) {
                    p.fill = "currentColor";
                    return h("svg", p, h("path", { d: dPath }));
                } else {
                    p.fill = "none";
                    p.stroke = "currentColor";
                    p.strokeWidth = "2";
                    p.strokeLinecap = "round";
                    p.strokeLinejoin = "round";
                    return h("svg", p, dPath);
                }
            };
        }

        var Icons = {
            Heart: createIcon("M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z", true),
            Alert: createIcon([h("circle", { cx: 12, cy: 12, r: 10 }), h("line", { x1: 12, y1: 8, x2: 12, y2: 12 }), h("line", { x1: 12, y1: 16, x2: 12.01, y2: 16 })], false),
            Clock: createIcon([h("circle", { cx: 12, cy: 12, r: 10 }), h("polyline", { points: "12 6 12 12 16 14" })], false),
            Wallet: createIcon([h("path", { d: "M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4" }), h("path", { d: "M4 6v12a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2z" })], false),
            Pig: createIcon([h("path", { d: "M19 5c-1.5 0-2.8.6-3.8 1.5l-2.5 2.5c-.3.3-.7.3-1 0l-2.6-2.6c-.3-.3-.3-.7 0-1L11.6 3c.6-.6 1.5-.6 2.1 0l.4.4" }), h("path", { d: "M2 15c0 3.9 3.1 7 7 7 2.4 0 4.5-1.2 5.8-3l.5.5c.8.8 2.1.8 2.8 0l2.8-2.8c.8-.8.8-2.1 0-2.8l-.5-.5c1.8-1.3 3-3.4 3-5.8 0-2.2-1-4.2-2.6-5.6l-3.3 3.3c-.3.3-.7.3-1 0l-2.6-2.6c-.3-.3-.3-.7 0-1L16.4 2c-1.4-1.6-3.4-2.6-5.6-2.6-3.9 0-7 3.1-7 7v.5C2 7.8 2 8.9 2 10z" }), h("path", { d: "M9 13v.01" }), h("path", { d: "M15 9v.01" })], false),
            Pulse: createIcon([h("polyline", { points: "22 12 18 12 15 21 9 3 6 12 2 12" })], false),
            Gift: createIcon([h("polyline", { points: "20 12 20 22 4 22 4 12" }), h("rect", { x: 2, y: 7, width: 20, height: 5 }), h("line", { x1: 12, y1: 22, x2: 12, y2: 7 }), h("path", { d: "M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z" }), h("path", { d: "M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z" })], false),
            Image: createIcon([h("rect", { x: 3, y: 3, width: 18, height: 18, rx: 2, ry: 2 }), h("circle", { cx: 8.5, cy: 8.5, r: 1.5 }), h("polyline", { points: "21 15 16 10 5 21" })], false),
            Trash: createIcon([h("polyline", { points: "3 6 5 6 21 6" }), h("path", { d: "M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" })], false),
            ArrowRight: createIcon([h("line", { x1: 5, y1: 12, x2: 19, y2: 12 }), h("polyline", { points: "12 5 19 12 12 19" })], false),
        };

        // --- Utils ---
        var Storage = {
            get: function(key, def) {
                try {
                    var v = localStorage.getItem(APP_KEY + '_' + key);
                    return v ? JSON.parse(v) : def;
                } catch(e) { return def; }
            },
            set: function(key, val) {
                try {
                    localStorage.setItem(APP_KEY + '_' + key, JSON.stringify(val));
                    return true;
                } catch(e) { return false; }
            },
            clear: function() {
                try {
                    Object.keys(localStorage).forEach(function(k) {
                        if(k.indexOf(APP_KEY) === 0) localStorage.removeItem(k);
                    });
                } catch(e) {}
            }
        };

        var resizeImage = function(file) {
            return new Promise(function(resolve, reject) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    var img = new Image();
                    img.onload = function() {
                        try {
                            var canvas = document.createElement('canvas');
                            var w = img.width; var h = img.height;
                            var max = 600; 
                            if(w > h) { if(w > max) { h *= max/w; w=max; } } else { if(h > max) { w *= max/h; h=max; } }
                            canvas.width = w; canvas.height = h;
                            var ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, w, h);
                            resolve(canvas.toDataURL('image/jpeg', 0.8));
                        } catch(err) { reject(err); }
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        };

        // --- Components ---
        function App() {
            var gameStateVal = useState('loading');
            var gameState = gameStateVal[0], setGameState = gameStateVal[1];

            var profileVal = useState(null);
            var profile = profileVal[0], setProfile = profileVal[1];

            var heroinesVal = useState([]);
            var heroines = heroinesVal[0], setHeroines = heroinesVal[1];
            
            var timerVal = useState({ d:0, h:0, m:0, s:0, wallet:0, totalSaved:0, totalHours: 0 });
            var timerData = timerVal[0], setTimerData = timerVal[1];

            var sosVal = useState(false);
            var isSosMode = sosVal[0], setIsSosMode = sosVal[1];

            var sosMsgVal = useState("");
            var sosMessage = sosMsgVal[0], setSosMessage = sosMsgVal[1];

            var resetVal = useState(false);
            var showResetConfirm = resetVal[0], setShowResetConfirm = resetVal[1];

            var bonusVal = useState(null);
            var loginBonus = bonusVal[0], setLoginBonus = bonusVal[1];

            var giftVal = useState(null);
            var giftEvent = giftVal[0], setGiftEvent = giftVal[1];

            var tapVal = useState(false);
            var tapAnim = tapVal[0], setTapAnim = tapVal[1];

            var prevVal = useState({ normal: null, happy: null, sad: null });
            var previewImages = prevVal[0], setPreviewImages = prevVal[1];

            var dialVal = useState("");
            var dialogue = dialVal[0], setDialogue = dialVal[1];

            useEffect(function() {
                var loader = document.getElementById('app-loader');
                if (loader) loader.style.display = 'none';

                var p = Storage.get('profile', null);
                var hData = Storage.get('heroines', []);
                if (p && p.startQuitDate) {
                    setProfile(p);
                    setHeroines(hData);
                    setGameState('main');
                } else {
                    setProfile({ 
                        dailyTarget: 20, 
                        pricePerPack: 600, 
                        accumulatedMoney: 0, 
                        love: 0, 
                        goalName: 'Ëá™ÂàÜ„Å∏„ÅÆ„ÅîË§íÁæé', 
                        goalCost: 10000, 
                        lastLoginDate: null 
                    });
                    setGameState('setup');
                }
            }, []);

            function getScenario(love) {
                love = love || 0;
                var h = new Date().getHours();
                var timeKey = (h >= 5 && h < 11) ? 'morning' : (h >= 11 && h < 18) ? 'day' : (h >= 23 || h < 4) ? 'lateNight' : 'night';
                var stage = love >= 2000 ? 'stage3' : love >= 500 ? 'stage2' : 'stage1';
                var list = SCENARIO_DB[stage][timeKey];
                return list[Math.floor(Math.random() * list.length)];
            }

            useEffect(function() {
                if (gameState === 'main' && profile) {
                    setDialogue(getScenario(profile.love));
                }
            }, [gameState]);

            useEffect(function() {
                if(!profile || !profile.startQuitDate) return;
                
                var todayStr = new Date().toDateString();
                if (profile.lastLoginDate !== todayStr && gameState === 'main') {
                    var omikuji = OMIKUJI_DATA[Math.floor(Math.random() * OMIKUJI_DATA.length)];
                    var nextLove = (profile.love || 0) + omikuji.love;
                    var updatedProfile = Object.assign({}, profile, { love: nextLove, lastLoginDate: todayStr });
                    setProfile(updatedProfile);
                    Storage.set('profile', updatedProfile);
                    setTimeout(function() { setLoginBonus(omikuji); }, 1500);
                }

                var tick = function() {
                    var now = new Date();
                    var start = new Date(profile.startQuitDate);
                    var diffMs = now - start;
                    if(diffMs < 0) return;

                    var d = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                    var h = Math.floor((diffMs / (1000 * 60 * 60)) % 24);
                    var m = Math.floor((diffMs / (1000 * 60)) % 60);
                    var s = Math.floor((diffMs / 1000) % 60);
                    var totalHours = diffMs / (1000 * 60 * 60);
                    
                    var totalDaysFloat = diffMs / (1000 * 60 * 60 * 24);
                    var totalSaved = Math.floor(totalDaysFloat * (profile.dailyTarget || 0) * ((profile.pricePerPack || 600) / 20));
                    var wallet = (profile.accumulatedMoney || 0) + totalSaved;

                    setTimerData({ d: d, h: h, m: m, s: s, wallet: wallet, totalSaved: totalSaved, totalHours: totalHours });
                };
                tick();
                var interval = setInterval(tick, 1000);
                return function() { clearInterval(interval); };
            }, [profile, gameState]);

            useEffect(function() {
                if (isSosMode) {
                    var updateMsg = function() { setSosMessage(SOS_MESSAGES[Math.floor(Math.random() * SOS_MESSAGES.length)]); };
                    updateMsg();
                    var interval = setInterval(updateMsg, 6000);
                    return function() { clearInterval(interval); };
                }
            }, [isSosMode]);

            var heroImages = useMemo(function() {
                var active = null;
                if (profile && profile.currentHeroineId) {
                    active = heroines.find(function(h) { return h.id === profile.currentHeroineId; });
                }
                active = active || heroines[0];

                if (!active) return { normal: null, happy: null, sad: null };
                return {
                    normal: active.img || null,
                    happy: active.imgHappy || active.img || null,
                    sad: active.imgSad || active.img || null
                };
            }, [heroines, profile]);

            var handleImageSelect = function(e, type) {
                if (e.target.files && e.target.files[0]) {
                    resizeImage(e.target.files[0]).then(function(base64) {
                        setPreviewImages(function(prev) {
                            var next = Object.assign({}, prev);
                            next[type] = base64;
                            return next;
                        });
                    }).catch(function() { alert("Ë™≠ËæºÂ§±Êïó"); });
                }
            };

            var finishSetupOne = function(e) {
                e.preventDefault();
                var f = new FormData(e.target);
                setProfile(Object.assign({}, profile, { 
                    dailyTarget: parseInt(f.get('c')) || 20, 
                    pricePerPack: parseInt(f.get('p')) || 600,
                    goalName: f.get('goalName') || 'Ëá™ÂàÜ„Å∏„ÅÆ„ÅîË§íÁæé',
                    goalCost: parseInt(f.get('goalCost')) || 10000
                }));
                setGameState('char_reg');
            };

            var registerHeroine = function() {
                if (!previewImages.normal) return alert("ÈÄöÂ∏∏ÁîªÂÉè„ÅØÂøÖÈ†à„Åß„ÅôÔºÅ");
                
                var dateStr = new Date().toISOString();
                var createdHeroine = { 
                    id: Date.now().toString(), 
                    img: previewImages.normal, 
                    imgHappy: previewImages.happy || previewImages.normal,
                    imgSad: previewImages.sad || previewImages.normal,
                    createdAt: dateStr 
                };
                
                var nextHeroines = [createdHeroine].concat(heroines);
                var nextProfile = Object.assign({}, profile);
                if (!nextProfile.startQuitDate) {
                    nextProfile.startQuitDate = dateStr;
                }
                nextProfile.currentHeroineId = createdHeroine.id;

                if (Storage.set('heroines', nextHeroines) && Storage.set('profile', nextProfile)) {
                    setHeroines(nextHeroines);
                    setProfile(nextProfile);
                    setGameState('main');
                }
            };

            var giveGift = function(gift) {
                if (timerData.wallet < gift.cost) return alert("„ÅÇ„Å® ¬•" + (gift.cost - timerData.wallet).toLocaleString() + " Ë∂≥„Çä„Åæ„Åõ„ÇìÔºÅ");
                
                var nextLove = (profile.love||0) + gift.love;
                var nextAccumulated = (profile.accumulatedMoney||0) - gift.cost;
                var nextProfile = Object.assign({}, profile, { accumulatedMoney: nextAccumulated, love: nextLove });
                
                setProfile(nextProfile);
                Storage.set('profile', nextProfile);
                
                setGiftEvent(gift);
                setTimeout(function() { setGiftEvent(null); }, 3000);
            };

            var handleTap = function() {
                if (tapAnim) return;
                setTapAnim(true);
                var nextLove = (profile.love || 0) + 1;
                var nextProfile = Object.assign({}, profile, { love: nextLove });
                setProfile(nextProfile);
                Storage.set('profile', nextProfile);
                setTimeout(function() { setTapAnim(false); }, 300);
            };

            var toggleSos = function() {
                setIsSosMode(!isSosMode);
            };

            var resetData = function() {
                if(confirm("„Éá„Éº„Çø„ÇíÊ∂àÂéª„Åó„Åæ„Åô„ÅãÔºü")) {
                    Storage.clear();
                    location.reload();
                }
            };

            var getHeroineImage = function() {
                if (isSosMode) return heroImages.sad;
                if (giftEvent || tapAnim) return heroImages.happy;
                return heroImages.normal;
            };

            var getLevelInfo = function(love) {
                var level = Math.floor(love / 100) + 1;
                var nextExp = 100 - (love % 100);
                var currentExp = love % 100;
                return { level: level, nextExp: nextExp, currentExp: currentExp };
            };

            // ÁèæÂú®„ÅÆÂÅ•Â∫∑ÂäπÊûú„Å®„ÄÅÊ¨°„ÅÆÂÅ•Â∫∑ÂäπÊûú„ÇíÂèñÂæó
            var getHealthInfo = function(hours) {
                var current = HEALTH_BENEFITS[0];
                var next = null;
                for (var i = 0; i < HEALTH_BENEFITS.length; i++) {
                    if (hours >= HEALTH_BENEFITS[i].h) {
                        current = HEALTH_BENEFITS[i];
                    } else {
                        next = HEALTH_BENEFITS[i];
                        break;
                    }
                }
                return { current: current, next: next };
            };

            // RENDER
            if (gameState === 'loading') return null;

            if (gameState === 'setup') {
                return h("div", { className: "min-h-screen bg-rose-50 flex flex-col items-center justify-center p-6" },
                    h("div", { className: "w-full max-w-md bg-white rounded-2xl shadow-xl p-8 space-y-6" },
                        h("div", { className: "text-center" },
                            h("h1", { className: "text-2xl font-bold text-rose-600 mb-2" }, "„Éà„Ç≠„É°„Ç≠Á¶ÅÁÖô„É°„É¢„É™„Ç¢„É´"),
                            h("p", { className: "text-sm text-gray-500" }, "ÂàùÊúüË®≠ÂÆö")
                        ),
                        h("form", { onSubmit: finishSetupOne, className: "space-y-4" },
                            h("div", null,
                                h("label", { className: "block text-sm font-medium text-gray-700" }, "1Êó•„ÅÆÊú¨Êï∞"),
                                h("input", { name: "c", type: "number", defaultValue: "20", required: true, className: "mt-1 w-full p-3 rounded-lg border border-gray-300" })
                            ),
                            h("div", null,
                                h("label", { className: "block text-sm font-medium text-gray-700" }, "1ÁÆ±„ÅÆÂÄ§ÊÆµ(ÂÜÜ)"),
                                h("input", { name: "p", type: "number", defaultValue: "600", required: true, className: "mt-1 w-full p-3 rounded-lg border border-gray-300" })
                            ),
                            h("div", null,
                                h("label", { className: "block text-sm font-medium text-gray-700" }, "ÁõÆÊ®ô"),
                                h("input", { name: "goalName", type: "text", placeholder: "ÊóÖË°å„Å™„Å©", className: "mt-1 w-full p-3 rounded-lg border border-gray-300" })
                            ),
                            h("div", null,
                                h("label", { className: "block text-sm font-medium text-gray-700" }, "ÁõÆÊ®ôÈáëÈ°ç(ÂÜÜ)"),
                                h("input", { name: "goalCost", type: "number", placeholder: "30000", className: "mt-1 w-full p-3 rounded-lg border border-gray-300" })
                            ),
                            h("button", { type: "submit", className: "w-full bg-rose-500 hover:bg-rose-600 text-white font-bold py-3 rounded-xl shadow-md" }, "Ê¨°„Å∏")
                        )
                    )
                );
            }

            if (gameState === 'char_reg') {
                return h("div", { className: "min-h-screen bg-rose-50 flex flex-col items-center p-6 overflow-y-auto" },
                    h("div", { className: "w-full max-w-md bg-white rounded-2xl shadow-xl p-6 space-y-6 my-auto" },
                        h("div", { className: "text-center" },
                            h("h2", { className: "text-xl font-bold text-gray-800" }, "„Éë„Éº„Éà„Éä„ÉºÁôªÈå≤"),
                            h("p", { className: "text-xs text-gray-500 mt-1" }, "ÁîªÂÉè„ÇíÁôªÈå≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ")
                        ),
                        [
                            { k:'normal', l:'ÈÄöÂ∏∏ (ÂøÖÈ†à)' },
                            { k:'happy', l:'Âñú„Å≥ (‰ªªÊÑè)' },
                            { k:'sad', l:'ÊÇ≤„Åó„Åø (‰ªªÊÑè)' }
                        ].map(function(mode) {
                            return h("div", { key: mode.k, className: "flex items-center space-x-4" },
                                h("div", { className: "relative w-20 h-20 bg-gray-100 rounded-full overflow-hidden flex-shrink-0 border-2 border-gray-200" },
                                    previewImages[mode.k] ? 
                                        h("img", { src: previewImages[mode.k], className: "w-full h-full object-cover" }) :
                                        h("div", { className: "w-full h-full flex items-center justify-center text-gray-300" }, h(Icons.Image, { className: "w-6 h-6" }))
                                ),
                                h("div", { className: "flex-1" },
                                    h("label", { className: "block text-sm font-bold text-gray-700" }, mode.l),
                                    h("input", { type: "file", accept: "image/*", onChange: function(e){ handleImageSelect(e, mode.k); }, className: "block w-full text-xs text-gray-500 mt-1" })
                                )
                            );
                        }),
                        h("div", { className: "pt-4" },
                            h("button", { onClick: registerHeroine, className: "w-full bg-gradient-to-r from-rose-500 to-pink-500 text-white font-bold py-4 rounded-xl shadow-lg" }, "Âßã„ÇÅ„ÇãÔºÅ")
                        )
                    )
                );
            }

            var lvlInfo = getLevelInfo(profile.love);
            var healthInfo = getHealthInfo(timerData.totalHours);
            
            // ÈÄ≤ÊçóË®àÁÆó
            var rawPercent = (timerData.totalSaved / (profile.goalCost || 1)) * 100;
            var goalPercent = Math.min(100, rawPercent).toFixed(1);

            // Ê¨°„ÅÆÂÅ•Â∫∑ÂäπÊûú„Åæ„Åß„ÅÆÈÄ≤ÊçóË®àÁÆó
            var healthProgress = 0;
            var hoursToNext = 0;
            if (healthInfo.next) {
                var prevH = healthInfo.current.h;
                var nextH = healthInfo.next.h;
                healthProgress = Math.min(100, Math.max(0, ((timerData.totalHours - prevH) / (nextH - prevH)) * 100));
                hoursToNext = (nextH - timerData.totalHours).toFixed(1);
            }

            return h("div", { className: "relative h-full overflow-hidden flex flex-col transition-colors duration-700 " + (isSosMode ? 'bg-slate-900' : 'bg-rose-50') },
                isSosMode && h("div", { className: "absolute inset-0 z-0 pointer-events-none" },
                    h("div", { className: "absolute inset-0 bg-red-900/20 animate-pulse" })
                ),
                h("div", { className: "flex-1 overflow-y-auto pb-24 hide-scrollbar relative z-10" },
                    // Header
                    h("div", { className: "px-4 pt-4 flex justify-between items-center mb-4" },
                        h("div", { className: "bg-white/90 backdrop-blur text-rose-500 px-4 py-1.5 rounded-full shadow-sm flex items-center space-x-1 font-bold text-sm border border-rose-100" },
                            h(Icons.Heart, { className: "w-4 h-4" }),
                            h("span", null, "Lv." + lvlInfo.level)
                        ),
                        h("button", { onClick: function(){ setShowResetConfirm(true); }, className: "bg-white/90 backdrop-blur text-gray-500 px-3 py-1.5 rounded-full shadow-sm flex items-center space-x-1 text-xs border border-gray-100 hover:bg-gray-50" },
                            h(Icons.Trash, { className: "w-3 h-3" }),
                            h("span", null, "ÂâäÈô§")
                        )
                    ),
                    // Heroine & Bubble
                    h("div", { className: "flex flex-col items-center mb-8 px-4" },
                        h("div", { 
                            className: "relative w-48 h-48 md:w-64 md:h-64 rounded-full border-[6px] border-white shadow-xl overflow-hidden cursor-pointer transition-transform active:scale-95 " + (tapAnim ? 'scale-95' : ''),
                            onClick: handleTap
                        },
                            (tapAnim && !isSosMode) && h("div", { className: "absolute inset-0 flex items-center justify-center pointer-events-none z-20" },
                                h(Icons.Heart, { className: "w-20 h-20 text-rose-500 animate-ping opacity-75" })
                            ),
                            getHeroineImage() ? 
                                h("img", { src: getHeroineImage(), className: "w-full h-full object-cover transition duration-500 " + (isSosMode ? 'grayscale-[50%] brightness-75' : '') }) :
                                h("div", { className: "w-full h-full flex items-center justify-center bg-gray-200 text-gray-400" }, "No Image")
                        ),
                        h("div", { className: "mt-4 relative px-6 py-4 rounded-2xl shadow-sm max-w-sm text-center w-full animate-float " + (isSosMode ? 'bg-red-900/80 text-white border border-red-500' : 'bg-white text-slate-700 font-medium') },
                            h("div", { className: "absolute -top-2 left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-b-[8px] " + (isSosMode ? 'border-b-red-900/80' : 'border-b-white') }),
                            h("p", { className: "text-sm leading-relaxed" }, isSosMode ? sosMessage : dialogue)
                        )
                    ),
                    // Stats Grid
                    h("div", { className: "px-4 grid grid-cols-2 gap-3 mb-3" },
                        h("div", { className: "bg-white rounded-2xl p-4 shadow-sm flex flex-col justify-center items-center h-32" },
                            h("div", { className: "text-xs text-gray-400 mb-1 flex items-center" }, h(Icons.Clock, { className: "w-3 h-3 mr-1" }), "Á¶ÅÁÖôÊôÇÈñì"),
                            h("div", { className: "text-slate-800 font-bold text-lg leading-tight" }, timerData.d, h("span", { className: "text-sm font-normal" }, "Êó•"), " ", timerData.h, h("span", { className: "text-sm font-normal" }, "ÊôÇÈñì")),
                            h("div", { className: "text-slate-800 font-bold text-lg leading-tight mt-1" }, timerData.m, h("span", { className: "text-sm font-normal" }, "ÂàÜ"), " ", h("span", { className: "text-rose-500" }, timerData.s), h("span", { className: "text-sm font-normal text-rose-500" }, "Áßí"))
                        ),
                        h("div", { className: "bg-white rounded-2xl p-3 shadow-sm flex flex-col h-32 relative overflow-hidden" },
                            h("div", { className: "text-xs text-gray-400 mb-1 flex items-center" }, h(Icons.Wallet, { className: "w-3 h-3 mr-1" }), "Êé®„ÅóÊ¥ªÊÆãÈ´ò"),
                            h("div", { className: "flex-1 flex flex-col justify-center" },
                                h("div", { className: "flex items-baseline space-x-1" }, h("span", { className: "text-rose-500 font-bold text-2xl" }, "¬•" + timerData.wallet.toLocaleString())),
                                h("div", { className: "text-[10px] text-gray-400 mt-1 flex items-center" }, h(Icons.Pig, { className: "w-3 h-3 mr-1 text-gray-400" }), "Á¥ØË®à: ¬•" + timerData.totalSaved.toLocaleString())
                            ),
                            h("div", { className: "w-full mt-auto" },
                                h("div", { className: "flex justify-between text-[10px] text-gray-400 mb-0.5" },
                                    h("span", { className: "truncate max-w-[70px]" }, profile.goalName),
                                    h("span", null, goalPercent + "%")
                                ),
                                h("div", { className: "w-full bg-gray-100 rounded-full h-1.5" },
                                    h("div", { className: "bg-yellow-400 h-1.5 rounded-full transition-all duration-1000", style: { width: goalPercent + '%' } })
                                )
                            )
                        )
                    ),
                    // Health Card (Updated)
                    h("div", { className: "px-4 mb-6" },
                        h("div", { className: "bg-emerald-50 rounded-2xl p-4 border border-emerald-100 shadow-sm" },
                            h("div", { className: "flex items-start space-x-3" },
                                h("div", { className: "bg-emerald-100 p-2 rounded-full text-emerald-600 mt-1" }, h(Icons.Pulse, { className: "w-5 h-5" })),
                                h("div", { className: "flex-1" },
                                    h("div", { className: "font-bold text-emerald-800 text-sm" }, healthInfo.current.t),
                                    h("div", { className: "text-xs text-emerald-700 leading-relaxed mt-0.5" }, healthInfo.current.d)
                                )
                            ),
                            healthInfo.next && h("div", { className: "mt-3 pt-3 border-t border-emerald-100" },
                                h("div", { className: "flex justify-between items-center text-[10px] text-emerald-600 mb-1" },
                                    h("span", null, "Next: " + healthInfo.next.t),
                                    h("span", null, "„ÅÇ„Å® " + hoursToNext + " ÊôÇÈñì")
                                ),
                                h("div", { className: "w-full bg-emerald-200 rounded-full h-1" },
                                    h("div", { className: "bg-emerald-500 h-1 rounded-full transition-all duration-1000", style: { width: healthProgress + '%' } })
                                )
                            )
                        )
                    ),
                    // SOS
                    h("div", { className: "px-4 mb-8" },
                        h("button", { onClick: toggleSos, className: "w-full py-4 rounded-full font-bold shadow-lg transition transform active:scale-95 flex items-center justify-center space-x-2 " + (isSosMode ? 'bg-gray-600 text-white hover:bg-gray-700' : 'bg-slate-800 text-white hover:bg-slate-900') },
                            isSosMode ? h("span", null, "Âπ≥Â∏∏„É¢„Éº„Éâ„Å´Êàª„Çã") : [h(Icons.Alert, { className: "w-5 h-5 text-rose-400" }), h("span", null, "Âê∏„ÅÑ„Åü„Åè„Å™„Å£„Åü„ÇâÊäº„Åó„Å¶ÔºÅ")]
                        )
                    ),
                    // Gifts
                    h("div", { className: "px-4 mb-20" },
                        h("h3", { className: "text-sm font-bold text-gray-600 mb-3 flex items-center" }, h(Icons.Gift, { className: "w-4 h-4 mr-1 text-rose-400" }), "ÊÄù„ÅÑÂá∫„Çí„Éó„É¨„Çº„É≥„Éà"),
                        h("div", { className: "flex space-x-3 overflow-x-auto pb-4 hide-scrollbar" },
                            GIFTS.map(function(g) {
                                var canBuy = timerData.wallet >= g.cost;
                                return h("button", { 
                                    key: g.id, 
                                    onClick: function() { if(canBuy) giveGift(g); }, 
                                    disabled: isSosMode,
                                    className: "flex-shrink-0 w-32 bg-white rounded-2xl p-3 flex flex-col items-center shadow-sm border transition-all active:scale-95 " + (canBuy ? 'border-rose-100 hover:border-rose-200' : 'border-gray-100 opacity-60 grayscale')
                                },
                                    h("div", { className: "text-3xl mb-2" }, g.icon),
                                    h("div", { className: "text-xs font-bold text-gray-800 mb-1" }, g.name),
                                    h("div", { className: "text-xs font-bold rounded-full px-2 py-0.5 " + (canBuy ? 'bg-rose-50 text-rose-500' : 'bg-gray-100 text-gray-400') }, "¬•" + g.cost.toLocaleString())
                                );
                            })
                        )
                    )
                ),
                // Footer
                h("div", { className: "absolute bottom-0 left-0 w-full bg-white/90 backdrop-blur border-t border-rose-100 p-3 z-30 pb-safe" },
                    h("div", { className: "flex justify-between items-end mb-1 px-1" },
                        h("div", { className: "text-xs font-bold text-gray-400" }, "LOVE POINT (Lv." + lvlInfo.level + ")"),
                        h("div", { className: "text-xs font-bold text-rose-400" }, lvlInfo.currentExp + " / Next " + (lvlInfo.nextExp + lvlInfo.currentExp))
                    ),
                    h("div", { className: "w-full bg-gray-100 rounded-full h-2" },
                        h("div", { className: "bg-rose-500 h-2 rounded-full transition-all duration-500 shadow-[0_0_10px_rgba(244,63,94,0.5)]", style: { width: (lvlInfo.currentExp / (lvlInfo.nextExp + lvlInfo.currentExp)) * 100 + '%' } })
                    )
                ),
                // Overlays
                giftEvent && h("div", { className: "fixed inset-0 z-50 flex items-center justify-center pointer-events-none" },
                    h("div", { className: "absolute inset-0 bg-white/30 backdrop-blur-[2px]" }),
                    h("div", { className: "relative text-center animate-heartbeat z-10 p-8 bg-white/90 rounded-3xl shadow-2xl border-4 border-rose-200" },
                        h("div", { className: "text-8xl mb-4" }, giftEvent.icon),
                        h("div", { className: "text-2xl font-bold text-rose-500 mb-1" }, "Love +" + giftEvent.love),
                        h("div", { className: "text-gray-500 text-sm" }, "Â•ΩÊÑüÂ∫¶„Ç¢„ÉÉ„ÉóÔºÅ")
                    )
                ),
                loginBonus && h("div", { className: "fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-6 backdrop-blur-sm", onClick: function(){ setLoginBonus(null); } },
                    h("div", { className: "bg-white rounded-3xl p-8 text-center max-w-xs w-full animate-pop shadow-2xl relative overflow-hidden" },
                        h("div", { className: "absolute top-0 left-0 w-full h-3 bg-gradient-to-r from-rose-400 to-rose-500" }),
                        h("div", { className: "text-sm font-bold text-gray-400 mb-2" }, "LOGIN BONUS"),
                        h("div", { className: "text-6xl my-4" }, "‚õ©Ô∏è"),
                        h("div", { className: "text-3xl font-bold text-rose-600 mb-1" }, loginBonus.type),
                        h("p", { className: "text-sm text-gray-500 mb-6" }, loginBonus.msg),
                        h("div", { className: "inline-block bg-rose-50 text-rose-600 px-6 py-2 rounded-full text-sm font-bold shadow-sm border border-rose-100" }, "Love +" + loginBonus.love)
                    )
                ),
                showResetConfirm && h("div", { className: "fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-6" },
                    h("div", { className: "bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl animate-pop" },
                        h("h3", { className: "text-lg font-bold text-gray-800 mb-4 text-center" }, "„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü"),
                        h("div", { className: "space-y-3" },
                            h("button", { onClick: resetData, className: "w-full font-bold py-3 text-white bg-rose-500 rounded-xl shadow-lg hover:bg-rose-600" }, "„ÅØ„ÅÑ„ÄÅÂâäÈô§„Åó„Åæ„Åô"),
                            h("button", { onClick: function(){ setShowResetConfirm(false); }, className: "w-full py-3 text-gray-500 bg-gray-100 rounded-xl hover:bg-gray-200" }, "„Ç≠„É£„É≥„Çª„É´")
                        )
                    )
                )
            );
        }

        // Start
        window.onload = function() {
            var container = document.getElementById('root');
            var root = ReactDOM.createRoot(container);
            root.render(h(App));
        };
    </script>
</body>
</html>
